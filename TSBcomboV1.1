-- AUTO COMBO TSB + GUI

getgenv().AutoCombo = false

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local VIM = game:GetService("VirtualInputManager")
local lp = Players.LocalPlayer

local ATTACK_DIST = 9
local DASH_DIST = 14

-- INPUT
local function M1()
    VIM:SendMouseButtonEvent(0,0,0,true,game,0)
    task.wait(0.05)
    VIM:SendMouseButtonEvent(0,0,0,false,game,0)
end

local function Dash()
    VIM:SendKeyEvent(true, Enum.KeyCode.Q, false, game)
    task.wait(0.05)
    VIM:SendKeyEvent(false, Enum.KeyCode.Q, false, game)
end

local function Block(state)
    VIM:SendMouseButtonEvent(0,0,1,state,game,0)
end

-- TARGET
local function getTarget()
    local char = lp.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return nil end
    local hrp = char.HumanoidRootPart

    local closest, dist = nil, math.huge
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= lp and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
            local hum = p.Character:FindFirstChild("Humanoid")
            if hum and hum.Health > 0 then
                local d = (hrp.Position - p.Character.HumanoidRootPart.Position).Magnitude
                if d < dist and d < DASH_DIST then
                    dist = d
                    closest = p.Character
                end
            end
        end
    end
    return closest, dist
end

-- MAIN LOOP
RunService.RenderStepped:Connect(function()
    if not getgenv().AutoCombo then
        Block(false)
        return
    end

    local char = lp.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end

    local hrp = char.HumanoidRootPart
    local target, dist = getTarget()
    if not target then
        Block(false)
        return
    end

    local thrp = target.HumanoidRootPart
    hrp.CFrame = CFrame.new(hrp.Position, thrp.Position)

    if dist > ATTACK_DIST and dist < DASH_DIST then
        Dash()
        return
    end

    if dist < 4 then
        Block(true)
        return
    else
        Block(false)
    end

    if dist <= ATTACK_DIST then
        M1()
    end
end)

-- GUI
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "TSB_AutoCombo_GUI"

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 230, 0, 140)
Frame.Position = UDim2.new(0.05, 0, 0.4, 0)
Frame.BackgroundColor3 = Color3.fromRGB(20,20,20)
Frame.Active = true
Frame.Draggable = true

Instance.new("UICorner", Frame).CornerRadius = UDim.new(0,12)

local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1,0,0,40)
Title.Text = "ðŸ‘Š Auto Combo TSB"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.TextColor3 = Color3.new(1,1,1)
Title.BackgroundTransparency = 1

local Toggle = Instance.new("TextButton", Frame)
Toggle.Size = UDim2.new(0.8,0,0,45)
Toggle.Position = UDim2.new(0.1,0,0.5,0)
Toggle.Text = "OFF"
Toggle.Font = Enum.Font.GothamBold
Toggle.TextSize = 16
Toggle.TextColor3 = Color3.new(1,1,1)
Toggle.BackgroundColor3 = Color3.fromRGB(160,0,0)

Instance.new("UICorner", Toggle).CornerRadius = UDim.new(0,10)

Toggle.MouseButton1Click:Connect(function()
    getgenv().AutoCombo = not getgenv().AutoCombo
    if getgenv().AutoCombo then
        Toggle.Text = "ON"
        Toggle.BackgroundColor3 = Color3.fromRGB(0,160,0)
    else
        Toggle.Text = "OFF"
        Toggle.BackgroundColor3 = Color3.fromRGB(160,0,0)
    end
end)

print("âœ… Auto Combo TSB GUI Loaded")
